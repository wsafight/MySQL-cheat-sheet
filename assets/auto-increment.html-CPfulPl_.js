import{_ as n,c as i,b as t,o as a}from"./app--XYqrjBE.js";const s={};function l(r,e){return a(),i("div",null,e[0]||(e[0]=[t(`<h1 id="mysql-自增-id-重复利用" tabindex="-1"><a class="header-anchor" href="#mysql-自增-id-重复利用"><span>MySQL 自增 id 重复利用</span></a></h1><p>在 MySQL 8.0 版本前，当 MySQL 重新启动服务时候，innodb 的自增 ID，会在服务重启后，自动设置为记录中最大 ID + 1。</p><div class="language-SQL line-numbers-mode" data-highlighter="prismjs" data-ext="SQL" data-title="SQL"><pre><code><span class="line">select max(id)+1 from tbl_name</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>也就是说，如果在 MySQL 停止服务前一刻如果将最新的一条信息删除的话，数据表再插入记录，ID 依旧是之前的删除的那一条。</p><p>极端情况下，数据库重启服务前删除了当前表最大 ID 的记录，服务恢复后插入记录再去关联 ID 就会出现问题。</p><p>在 8.0 版本前的解决方案有两个</p><ul><li>软删除（不进行物理删除，而是在数据表中添加一个字段来确定当前数据是否可用）</li><li>使用 innodb_autoinc_persistent</li></ul><div class="language-SQL line-numbers-mode" data-highlighter="prismjs" data-ext="SQL" data-title="SQL"><pre><code><span class="line">innodb_autoinc_persistent=on</span>
<span class="line">innodb_autoinc_persistent_interval=1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>innodb_autoinc_persistent 配置为 on 责表示将 AUTO_INCREMENT 值实时存储在聚集索引根页。off 则采用原有方式只存储在内存中（可能会丢失）。</p><p>innodb_autoinc_persistent_interval 配置则表示每多少次间隔插入数据，如果自增为 1，innodb_autoinc_persistent_interval 为 100。就是每插入 100 条数据就会持久化一次，如果自增为 2 则每插入 50 条数据会持久化一次。</p><p>auto_incrememt_increment = 1 时候</p><ul><li>innodb_autoinc_persistent_interval=1 时性能损耗在 1% 以下。</li><li>innodb_autoinc_persistent_interval=100 时性能损耗可以忽略。</li></ul>`,12)]))}const o=n(s,[["render",l],["__file","auto-increment.html.vue"]]),c=JSON.parse('{"path":"/mysql/error/auto-increment.html","title":"MySQL 自增 id 重复利用","lang":"zh-CN","frontmatter":{},"headers":[],"git":{"updatedTime":1691424102000,"contributors":[{"name":"wsafight","email":"984292420@qq.com","commits":1}]},"filePathRelative":"mysql/error/auto-increment.md"}');export{o as comp,c as data};
