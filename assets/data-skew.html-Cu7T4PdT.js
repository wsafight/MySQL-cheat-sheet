import{_ as a,c as t,b as i,o as s}from"./app--XYqrjBE.js";const d={};function n(r,e){return s(),t("div",null,e[0]||(e[0]=[i(`<h1 id="避免分表数据倾斜" tabindex="-1"><a class="header-anchor" href="#避免分表数据倾斜"><span>避免分表数据倾斜</span></a></h1><p>单表数据量过大时，往往需要分表来解决数据库性能问题。</p><p>分表通常使用日期或者用户 id 来进行划分。如：电商订单表根据用户 id 来分 100 张表。开发者可以按照用户 id 取模 % 100。如用户 id 为 23423432234。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">23423432234 % 100 = 34</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>此时就可以将对应数据放入 order_34 这张表中。</p><p>如果当前开发者根据卖家 id 进行分表，可能会导致数据倾斜。因为有些商家订单数据很多，有些商家订单数据较少。如此，多张表的数据量差距就很大，甚至导致性能问题。</p><p>想要解决这个问题，就得在当前数据项中寻找到更加平衡的维度。如果我们不使用卖家 id，而是根据买家 id 进行分表，往往就不会出现数据倾斜。因为一个买家一般来说不会有非常多的订单数据。</p><p>针对电商系统来说，买家远远多于卖家，针对买家查询同一张表则会更快。同时开发者再根据 binlog 等信息生成卖家 id 对应的数据信息供卖家进行查询。</p><p>事实上，除了卖家和买家，往往第三方也需要对订单进行查询。如果当前没有买家 id 或者卖家 id 是否就不能查询了呢？答案是否定的。</p><p>电商系统往往会在订单号上添加对应信息。如同一个买家的淘宝订单号后六位都是相同的，而同一个买家的拼多多订单号后四位都是相同的（前六位是年月日）。不过在抖音平台个人没有发现订单位数相同的规律（相同买家或卖家均没有相同位数）。</p>`,10)]))}const l=a(d,[["render",n],["__file","data-skew.html.vue"]]),c=JSON.parse('{"path":"/mysql/performance/data-skew.html","title":"避免分表数据倾斜","lang":"zh-CN","frontmatter":{},"headers":[],"git":{"updatedTime":1694449888000,"contributors":[{"name":"wsafight","email":"984292420@qq.com","commits":1}]},"filePathRelative":"mysql/performance/data-skew.md"}');export{l as comp,c as data};
